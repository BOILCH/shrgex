# shrgex
Ekzamen pm01 2228


# 2.
LACP - протокол который делает из двух физических интов один логический (программный)
http://xgu.ru/wiki/LACP


LACP (Link Aggregation Control Protocol) предлагает несколько преимуществ по сравнению с другими методами агрегации каналов. Во-первых, он обеспечивает автоматическое управление и согласование между устройствами, что упрощает настройку. Во-вторых, LACP поддерживает динамическое добавление и удаление каналов, повышая гибкость и надежность сети.

    Широкая совместимость: LACP является стандартом IEEE 802.3ad, что делает его совместимым с оборудованием различных производителей, в отличие от собственных протоколов, таких как PAGP, которые ограничены устройствами Cisco.

    Автоматизированное управление: LACP автоматически управляет агрегацией каналов, что снижает вероятность ошибок, связанных с ручной настройкой. Это позволяет сетевым администраторам сосредоточиться на других задачах.

    Динамическое изменение конфигурации: В случае сбоя одного из каналов LACP автоматически перенастраивает группу, исключая неисправный канал и перераспределяя трафик на оставшиеся рабочие каналы, что обеспечивает бесперебойное соединение.

    Сложные алгоритмы балансировки нагрузки: LACP предлагает более продвинутые методы распределения трафика, что может привести к более эффективному использованию доступной пропускной способности.

    Упрощенное устранение неполадок: Использование стандартизированных протоколов облегчает диагностику и устранение проблем, так как сетевые администраторы могут полагаться на общепринятые методы и инструменты.

    Поддержка больших объемов трафика: LACP позволяет объединять до 16 физических каналов в один логический, что значительно увеличивает общую пропускную способность сети.

    Гибкость в масштабировании: LACP позволяет легко добавлять новые каналы в существующую агрегацию, что делает его идеальным выбором для растущих сетевых инфраструктур.

LACP (Link Aggregation Control Protocol) определяет несколько состояний для портов, которые помогают управлять агрегацией каналов и обеспечивают их корректную работу. Основные состояния LACP портов включают:

    Active (Активный): Порт активно участвует в агрегации и отправляет LACP-дуги (LACP PDUs) для установления и поддержания связи с другими устройствами. Порты в этом состоянии могут принимать участие в распределении трафика.

    Standby (Резервный): Порт находится в режиме ожидания и не участвует в агрегации, но готов к активации в случае сбоя активного порта. Он также может отправлять LACP-дуги, но не используется для передачи данных.

    Disabled (Отключен): Порт отключен и не участвует в агрегации. Он не отправляет LACP-дуги и не может быть использован для передачи данных. Это состояние может быть вызвано ручной настройкой или проблемами с оборудованием.

    Failed (Неисправен): Порт находится в состоянии ошибки, что может быть вызвано аппаратными сбоями, проблемами с подключением или неправильной конфигурацией. Порты в этом состоянии не могут участвовать в агрегации и не передают данные.

    Unknown (Неизвестно): Это состояние может возникнуть, если LACP не может определить состояние порта. Это может быть связано с проблемами в конфигурации или связи между устройствами.

Эти состояния помогают сетевым администраторам отслеживать и управлять состоянием портов в агрегации, обеспечивая надежность и эффективность работы сети.


# 3



OSPF (Open Shortest Path First) — это протокол динамической маршрутизации, который использует технологию отслеживания состояния канала для обмена информацией о маршрутах между маршрутизаторами. Он делит сеть на зоны, что позволяет оптимизировать маршрутизацию и повышает эффективность передачи данных.

Основные характеристики OSPF

    Протокол внутренней маршрутизации: OSPF предназначен для использования в пределах одной автономной системы, что означает, что все маршрутизаторы работают под едиными политиками маршрутизации.

    Алгоритм SPF: OSPF использует алгоритм Дейкстры (Shortest Path First) для вычисления наилучшего маршрута к каждой сети, основываясь на стоимости маршрутов.

    Link-State Technology: Протокол отслеживает состояние каналов и обменивается информацией о состоянии сети с помощью сообщений LSA (Link State Advertisement).

    Иерархическая структура: OSPF поддерживает иерархические зоны, что позволяет масштабировать сеть и уменьшать объем передаваемой информации.

Процесс работы OSPF

    Инициализация:
        При включении маршрутизатора OSPF выбирает уникальный Router ID, который может быть установлен вручную или автоматически.

    Обнаружение соседей:
        Маршрутизаторы отправляют hello-пакеты для обнаружения соседей и установления отношений соседства. Если ответ не получен, маршрутизатор считает соседей "мертвыми".

    Обмен LSA:
        После установления соседства маршрутизаторы обмениваются LSA-сообщениями, которые содержат информацию о состоянии каналов и доступных сетях.

    Синхронизация баз данных:
        Все маршрутизаторы синхронизируют свои базы данных состояния каналов (LSDB), чтобы иметь одинаковую информацию о топологии сети.

    Расчет маршрутов:

        После синхронизации маршрутизаторы используют алгоритм SPF для расчета наилучших маршрутов на основе стоимости, которая может зависеть от различных факторов, таких как пропускная способность канала.

Типы зон в OSPF

    Магистральная зона (Area 0): Основная зона, к которой подключаются все остальные зоны. Она обеспечивает связь между различными зонами.

    Стандартные зоны: Зоны, которые принимают обновления о состоянии каналов и маршрутах.

    Тупиковые зоны (Stub Areas): Зоны, которые не принимают внешние маршруты, но могут получать маршруты из других зон.

    NSSA (Not-So-Stubby Area): Зоны, которые могут инжектировать внешние маршруты, но не принимают их от других зон.

Заключение

OSPF является мощным и гибким протоколом маршрутизации, который обеспечивает эффективное управление маршрутами в больших и сложных сетях. Его способность к автоматическому обновлению маршрутов и поддержка иерархических структур делают его одним из наиболее популярных протоколов динамической маршрутизации.

В OSPF (Open Shortest Path First) процесс выбора Designated Router (DR) и Backup Designated Router (BDR) является важным этапом, который помогает оптимизировать обмен маршрутной информацией в сетях с несколькими маршрутизаторами. Этот процесс особенно актуален в сетях с использованием мультикастовой передачи, таких как Ethernet, где маршрутизаторы могут обмениваться информацией о состоянии каналов.
Процесс выбора DR и BDR

    Инициализация:
        Когда маршрутизаторы OSPF подключаются к одной и той же сети (например, Ethernet), они начинают обмениваться hello-пакетами для обнаружения соседей и установления отношений соседства.

    Обмен hello-пакетами:
        Каждый маршрутизатор отправляет hello-пакеты, которые содержат информацию о его идентификаторе, приоритетах, состоянии соседей и других параметрах. Эти пакеты помогают маршрутизаторам узнать друг о друге.

    Определение приоритета:
        Каждый маршрутизатор имеет значение приоритета (от 0 до 255), которое может быть настроено вручную. Если приоритет равен 0, маршрутизатор не может стать DR или BDR. Если приоритет не установлен, по умолчанию он равен 1.

    Выбор DR и BDR:
        После обмена hello-пакетами маршрутизаторы сравнивают свои приоритеты. Процесс выбора происходит следующим образом:
            Выбор DR: Маршрутизатор с наивысшим приоритетом становится DR. Если несколько маршрутизаторов имеют одинаковый наивысший приоритет, выбирается маршрутизатор с наивысшим Router ID.
            Выбор BDR: После выбора DR маршрутизаторы снова сравнивают свои приоритеты для выбора BDR. BDR также выбирается на основе наивысшего приоритета, и в случае равенства — по наивысшему Router ID.

    Объявление DR и BDR:
        После завершения выбора DR и BDR, маршрутизаторы объявляют свои роли в сети. DR будет отвечать за рассылку обновлений состояния каналов (LSA) всем соседям, а BDR будет готов взять на себя роль DR в случае его сбоя.

Зачем нужен DR и BDR?

    Снижение нагрузки: Выбор DR и BDR позволяет уменьшить количество LSA, которые передаются по сети. Вместо того чтобы каждый маршрутизатор отправлял свои обновления всем соседям, только DR рассылает информацию, что значительно снижает трафик.

    Отказоустойчивость: Наличие BDR обеспечивает резервирование. Если DR выходит из строя, BDR автоматически становится новым DR, что обеспечивает непрерывность работы сети.

Заключение

Процесс выбора DR и BDR в OSPF является ключевым для эффективного управления маршрутами в сетях с несколькими маршрутизаторами. Он помогает оптимизировать обмен информацией и обеспечивает отказоустойчивость, что делает OSPF одним из наиболее популярных протоколов маршрутизации в современных сетях.

В OSPF (Open Shortest Path First) существует несколько типов Link State Advertisements (LSAs), каждый из которых несет определенную информацию о состоянии сети. Эти LSAs используются для обмена информацией между маршрутизаторами и помогают им строить полную картину топологии сети. Вот основные типы LSAs и их содержание:
1. LSA Type 1: Router LSA

    Информация: Содержит информацию о маршрутизаторе, его интерфейсах и состоянии соединений.
    Используется в: Все маршрутизаторы OSPF.
    Содержимое:
        Router ID
        Состояние интерфейсов (up/down)
        Сетевые адреса и маски
        Соседние маршрутизаторы

2. LSA Type 2: Network LSA

    Информация: Создается Designated Router (DR) для мультидоступных сетей (например, Ethernet) и описывает сеть, к которой подключены маршрутизаторы.
    Используется в: Мультидоступных сетях.
    Содержимое:
        Router ID DR
        Список маршрутизаторов, подключенных к сети
        Сетевой адрес и маска

3. LSA Type 3: Summary LSA

    Информация: Используется для передачи информации о маршрутах между зонами OSPF (межзонные маршруты).
    Используется в: Агрегирующие маршрутизаторы (ABR).
    Содержимое:
        Сетевой адрес и маска
        Стоимость маршрута
        Идентификатор зоны

4. LSA Type 4: ASBR Summary LSA

    Информация: Используется для передачи информации о маршрутах к маршрутизаторам, которые подключены к внешним сетям (ASBR - Autonomous System Boundary Router).
    Используется в: Агрегирующие маршрутизаторы (ABR).
    Содержимое:
        Router ID ASBR
        Сетевой адрес и маска
        Стоимость маршрута

5. LSA Type 5: External LSA

    Информация: Используется для передачи информации о внешних маршрутах, которые поступают из других автономных систем (например, через протоколы BGP).
    Используется в: Все маршрутизаторы OSPF.
    Содержимое:
        Сетевой адрес и маска
        Стоимость маршрута
        Тип внешнего маршрута (E1 или E2)

6. LSA Type 6: Group Membership LSA

    Информация: Используется для передачи информации о членстве в группах multicast.
    Используется в: Специфических сценариях, связанных с multicast.
    Содержимое: Информация о группах и их членах.

7. LSA Type 7: NSSA External LSA

    Информация: Используется в Not-So-Stubby Areas (NSSA) для передачи информации о внешних маршрутах.
    Используется в: NSSA.
    Содержимое:
        Сетевой адрес и маска
        Стоимость маршрута
        Тип внешнего маршрута (E1 или E2)

Заключение

Каждый тип LSA в OSPF играет важную роль в обмене информацией о состоянии сети и помогает маршрутизаторам строить полную и актуальную картину топологии. Это позволяет OSPF эффективно управлять маршрутами и обеспечивать надежную маршрутизацию в сложных сетевых инфраструктурах.

OSPF (Open Shortest Path First) использует стоимость пути (path cost) для определения наилучшего маршрута к каждой сети. Стоимость пути — это метрика, которая указывает, насколько "дорогим" является маршрут, и она используется алгоритмом Дейкстры (Shortest Path First) для вычисления кратчайшего пути.
Определение стоимости пути

Стоимость пути в OSPF определяется на основе стоимости каждого интерфейса маршрутизатора. Каждый интерфейс имеет свою стоимость, которая может быть настроена вручную или рассчитана автоматически.
Параметры, влияющие на расчет стоимости пути

    Пропускная способность интерфейса:
        OSPF использует пропускную способность интерфейса для расчета стоимости. Чем выше пропускная способность, тем ниже стоимость. Например, стандартные значения стоимости для различных типов интерфейсов могут быть следующими:
            100 Mbps Ethernet: стоимость 1
            10 Mbps Ethernet: стоимость 10
            1 Gbps Ethernet: стоимость 1 (или 0.1, в зависимости от конфигурации)
        Формула для расчета стоимости интерфейса может выглядеть следующим образом:

    Настройки вручную:
        Администраторы могут вручную настроить стоимость интерфейса, чтобы изменить поведение маршрутизации. Это может быть полезно для управления трафиком и оптимизации маршрутов в сети.

    Тип интерфейса:
        Разные типы интерфейсов могут иметь разные значения стоимости по умолчанию. Например, стоимость для WAN-соединений может быть выше, чем для локальных Ethernet-соединений.

    Состояние интерфейса:
        Если интерфейс находится в состоянии "down" или "неисправен", он не будет учитываться в расчетах стоимости пути.

Пример расчета стоимости пути

Предположим, у нас есть сеть с тремя маршрутизаторами, и мы хотим рассчитать стоимость пути от маршрутизатора A до маршрутизатора C через маршрутизатор B. Пусть у маршрутизатора A есть интерфейс с пропускной способностью 100 Mbps (стоимость 1), у маршрутизатора B — интерфейс с пропускной способностью 10 Mbps (стоимость 10), а у маршрутизатора C — интерфейс с пропускной способностью 1 Gbps (стоимость 1).

    Стоимость пути A → B: 1
    Стоимость пути B → C: 10

Общая стоимость пути A → B → C будет равна: $ \text{Total Cost} = 1 + 10 = 11 $
Заключение

Стоимость пути в OSPF является ключевым параметром, который влияет на выбор маршрутов. Она определяется на основе пропускной способности интерфейсов, может быть настроена вручную и учитывает состояние интерфейсов. Это позволяет OSPF эффективно управлять маршрутами и обеспечивать оптимальную маршрутизацию в сети.

ля настройки OSPF на трех коммутаторах под управлением RED OS (Linux-based), мы будем использовать пакет quagga (или frr), который предоставляет функциональность динамической маршрутизации, включая поддержку OSPF. Вот пошаговая конфигурация:
Общая схема сети:

[Switch1] ---- (10.0.12.0/24) ---- [Switch2] ---- (10.0.23.0/24) ---- [Switch3]

   |                                     |

(192.168.1.0/24)                    (192.168.2.0/24)

Настройка для всех коммутаторов:

    Установите необходимые пакеты:

bash

sudo dnf install frr

sudo systemctl enable --now frr

    Включите OSPF в конфигурации FRR:

bash

sudo vtysh

configure terminal

router ospf

exit

exit

write

Конфигурация Switch1 (Router ID: 1.1.1.1):

bash

sudo vtysh


configure terminal


interface eth1

 ip address 10.0.12.1/24

 no shutdown

exit


interface eth2

 ip address 192.168.1.1/24

 no shutdown

exit


router ospf

 router-id 1.1.1.1

 network 10.0.12.0/24 area 0

 network 192.168.1.0/24 area 0

 passive-interface eth2  # если не нужны соседние отношения на этом интерфейсе

exit


exit

write

Конфигурация Switch2 (Router ID: 2.2.2.2):

bash

sudo vtysh


configure terminal


interface eth1

 ip address 10.0.12.2/24

 no shutdown

exit


interface eth2

 ip address 10.0.23.1/24

 no shutdown

exit


interface eth3

 ip address 192.168.2.1/24

 no shutdown

exit


router ospf

 router-id 2.2.2.2

 network 10.0.12.0/24 area 0

 network 10.0.23.0/24 area 0

 network 192.168.2.0/24 area 0

 passive-interface eth3

exit


exit

write

Конфигурация Switch3 (Router ID: 3.3.3.3):

bash

sudo vtysh


configure terminal


interface eth1

 ip address 10.0.23.2/24

 no shutdown

exit


interface eth2

 ip address 192.168.3.1/24

 no shutdown

exit


router ospf

 router-id 3.3.3.3

 network 10.0.23.0/24 area 0

 network 192.168.3.0/24 area 0

 passive-interface eth2

exit


exit

write

Проверка работы OSPF:

На любом коммутаторе выполните:

bash

sudo vtysh

show ip ospf neighbor  # проверка соседних отношений

show ip ospf route     # просмотр маршрутов

show ip route          # просмотр таблицы маршрутизации

Дополнительные настройки:

    Для изменения стоимости интерфейса:

bash

interface eth1

 ip ospf cost 100

    Для аутентификации OSPF:

bash

interface eth1

 ip ospf authentication message-digest

 ip ospf message-digest-key 1 md5 yourpassword

    Для изменения приоритета DR/BDR:

bash

interface eth1

 ip ospf priority 10

Важные заметки:

    Убедитесь, что файрволл разрешает OSPF трафик:

bash

sudo firewall-cmd --add-service=ospf --permanent

sudo firewall-cmd --reload

    В RED OS проверьте, что пакеты IP-форвардинга включены:

bash

sudo sysctl -w net.ipv4.ip_forward=1

    Для постоянной работы OSPF добавьте в /etc/sysctl.conf:

net.ipv4.ip_forward=1

После настройки всех трех коммутаторов, они должны автоматически установить соседские отношения и начать обмениваться маршрутной информацией через OSPF.
